  <!DOCTYPE html>
  <html style="font-size: 16px;" lang="en">
  <head>
    <style>
      .u-blog-post {
        text-align: center;
        display: inline-block;
        border: 1px solid #ccc;
        border-radius: 10px;
        margin: 10px;
        padding: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      
      .center-post {
        display: flex;
        justify-content: center;
      }
      .u-list-1 li {
    text-align: left; /* Align review content to the left */
    margin-bottom: 20px; /* Add spacing between reviews */
  }

  .u-list-1 strong {
    font-weight: bold;
    margin-right: 5px; /* Add spacing between author and date */
  }

  .rate.u-stars {
    margin-left: 500px;
}


    </style>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <meta name="keywords" content="AgroReviews">
    <meta name="description" content="">
    <title>Inicio</title>
    <link rel="stylesheet" href="nicepage.css" media="screen">
    <link rel="stylesheet" href="Inicio.css" media="screen">
    <script class="u-script" type="text/javascript" src="jquery.js" defer=""></script>
    <script class="u-script" type="text/javascript" src="nicepage.js" defer=""></script>
    <meta name="generator" content="Nicepage 5.20.7, nicepage.com">

    <link id="u-theme-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i|Open+Sans:300,300i,400,400i,500,500i,600,600i,700,700i,800,800i">
    <link id="u-page-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,500,500i,600,600i,700,700i,800,800i|Montserrat:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i">

    <script type="application/ld+json">{
      "@context": "http://schema.org",
      "@type": "Organization",
      "name": ""
    }</script>
    <meta name="theme-color" content="#478ac9">
    <meta property="og:title" content="Inicio">
    <meta property="og:type" content="website">
    <meta data-intl-tel-input-cdn-path="intlTelInput/">
  </head>
  <body data-home-page="index.html" data-home-page-title="Inicio" data-path-to-root="./" data-include-products="true" class="u-body u-xl-mode" data-lang="en">
    <header class="u-clearfix u-grey-10 u-header u-sticky u-sticky-614f u-header" id="sec-e39e">
      <div class="u-clearfix u-sheet u-sheet-1">
        <h1 class="u-custom-font u-font-montserrat u-text u-text-1">AgroReviews</h1>
          <nav class="u-align-left u-font-size-14 u-menu u-menu-hamburger u-nav-spacing-25 u-offcanvas u-menu-1" data-responsive-from="XL">
            <div class="menu-collapse">
              <a class="u-button-style u-nav-link" href="#" style="padding: 4px 0px; font-size: calc(1em + 8px);">
                <svg class="u-svg-link" preserveAspectRatio="xMidYMin slice" viewBox="0 0 302 302" style=""><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#svg-7b92"></use></svg>
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="svg-7b92" x="0px" y="0px" viewBox="0 0 302 302" style="enable-background:new 0 0 302 302;" xml:space="preserve" class="u-svg-content"><g><rect y="36" width="302" height="30"></rect><rect y="236" width="302" height="30"></rect><rect y="136" width="302" height="30"></rect>
  </g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g></svg>
              </a>
            </div>
            <div class="u-custom-menu u-nav-container">
              <ul class="u-nav u-unstyled u-nav-1"><li class="u-nav-item"><a class="u-button-style u-nav-link u-text-active-palette-1-base u-text-hover-palette-2-base" href="index.html#sec-59ec" style="padding: 10px 20px;">Inicio</a>
  </li><li class="u-nav-item"><a class="u-button-style u-nav-link u-text-active-palette-1-base u-text-hover-palette-2-base" href="index.html" style="padding: 10px 20px;">Sube un producto</a>
  </li><li class="u-nav-item"><a class="u-button-style u-nav-link u-text-active-palette-1-base u-text-hover-palette-2-base" href="Perfil.html" style="padding: 10px 20px;">Mi perfil</a>
  </li><li class="u-nav-item"><a class="u-button-style u-nav-link u-text-active-palette-1-base u-text-hover-palette-2-base" href="index.html#AboutUs" style="padding: 10px 20px;">Acerca de nosotros</a>
  </li></ul>
            </div>
            <div class="u-custom-menu u-nav-container-collapse">
              <div class="u-align-center u-border-2 u-border-grey-75 u-container-style u-custom-color-1 u-inner-container-layout u-sidenav">
                <div class="u-inner-container-layout u-sidenav-overflow">
                  <div class="u-menu-close u-menu-close-1"></div>
                  <ul class="u-align-left u-custom-font u-font-montserrat u-nav u-popupmenu-items u-unstyled u-nav-2"><li class="u-nav-item"><a class="u-button-style u-nav-link" href="index.html#sec-59ec">Inicio</a>
  </li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="index.html">Sube un producto</a>
  </li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Perfil.html">Mi perfil</a>
  </li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="index.html#AboutUs">Acerca de nosotros</a>
  </li></ul>
                </div>
              </div>
              <div class="u-black u-menu-overlay u-opacity u-opacity-70"></div>
            </div>
          </nav>
          <form action="#" method="get" class="u-border-2 u-border-black u-expanded-width-xs u-radius-12 u-search u-search-left u-white u-search-1">
            <button class="u-search-button" type="submit">
              <span class="u-search-icon u-spacing-10">
                <svg class="u-svg-link" preserveAspectRatio="xMidYMin slice" viewBox="0 0 56.966 56.966"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#svg-a58f"></use></svg>
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="svg-a58f" x="0px" y="0px" viewBox="0 0 56.966 56.966" style="enable-background:new 0 0 56.966 56.966;" xml:space="preserve" class="u-svg-content"><path d="M55.146,51.887L41.588,37.786c3.486-4.144,5.396-9.358,5.396-14.786c0-12.682-10.318-23-23-23s-23,10.318-23,23  s10.318,23,23,23c4.761,0,9.298-1.436,13.177-4.162l13.661,14.208c0.571,0.593,1.339,0.92,2.162,0.92  c0.779,0,1.518-0.297,2.079-0.837C56.255,54.982,56.293,53.08,55.146,51.887z M23.984,6c9.374,0,17,7.626,17,17s-7.626,17-17,17  s-17-7.626-17-17S14.61,6,23.984,6z"></path></svg>
              </span>
            </button>
            <input class="u-custom-font u-font-montserrat u-search-input" type="search" name="search" value="" placeholder="Search">
          </form>
        </div></header>
        <section class="u-align-left u-clearfix u-section-1" id="sec-2bc9">
          <div class="u-clearfix u-sheet u-valign-middle-md u-valign-middle-sm u-valign-middle-xs u-sheet-1">
            <div class="u-container-style u-expanded-width u-post-details u-post-details-1">
              <div class="u-container-layout u-valign-middle u-container-layout-1">
                <!-- Placeholder for post image -->
                <img alt="" class="u-blog-control u-expanded-width u-image u-image-default u-image-1" id="post-image"><br>
                <!-- Placeholder for post title -->
                <h3 class="u-blog-control u-text u-text-1" id="post-title" style="margin: 0;">Post Title</h3>
                <!-- Placeholder for user name -->
                <div class="u-blog-control u-metadata u-metadata-1" style="margin: 0;">
                  <span class="u-meta-user u-meta-icon" id="post-user">User Name</span>
                <!-- Placeholder for post date -->
                <div class="u-blog-control u-metadata u-metadata-2">
                  <span class="u-meta-date u-meta-icon" id="post-date"></span>
                </div>
                <!-- Placeholder for post content -->
                <div class="u-blog-control u-text u-text-2" id="post-content"></div><br>
                <div class="u-form u-form-1">
                <label for="quantity">Cantidad:</label>
                <input type="number" id="quantity" name="Cantidad" min="1" value="1"> 
                <button id="comprar-button" class="u-button u-button-primary u-button-1" type="button">Comprar</button><br><br>
                </div>
                </div>
              </div>
            </div>
          </div>
        </section>
        
        <section class="u-align-center u-clearfix u-section-2" id="sec-reviews">
          <div class="u-clearfix u-sheet u-sheet-2">
            <h3 class="u-text u-text-3">Reviews</h3>
            <br>
            <form id="review-form">
              <label id="author-label"for="author">Autor:</label>
              <input type="text" id="author" name="author" required><br><br>
            
              <div class="rate u-stars">
                <input type="radio" id="star5" name="rate" value="5">
                <label for="star5" title="text">5 stars</label>
                <input type="radio" id="star4" name="rate" value="4">
                <label for="star4" title="text">4 stars</label>
                <input type="radio" id="star3" name="rate" value="3">
                <label for="star3" title="text">3 stars</label>
                <input type="radio" id="star2" name="rate" value="2">
                <label for="star2" title="text">2 stars</label>
                <input type="radio" id="star1" name="rate" value="1">
                <label for="star1" title="text">1 star</label>
              </div><br><br><br>
            
              <label for="content">Review:</label>
              <textarea id="content" name="content" required></textarea><br><br>
            
              <div id="group-fields" style="display: none;">
                <label for="people-involved">Número de personas involucradas:</label><br>
                <input type="number" id="people-involved" name="people-involved" min="1" ead><br>
              </div>
            
              <button id="add-review-button" class="u-button u-button-primary u-button-1" type="submit">Add Review</button>
            </form>
            <ul id="reviews-list" class="u-list u-list-1">
              <!-- Reviews will be dynamically added here -->
            </ul>
          </div>
        </section>

      
      
      <footer class="u-align-center u-clearfix u-footer u-grey-80 u-footer" id="AboutUs"><div class="u-clearfix u-sheet u-sheet-1">
          <h4 id="AboutUs"class="u-align-left u-custom-font u-font-montserrat u-text u-text-1">Acerca de nosotros</h4>
          <p class="u-align-left u-custom-font u-font-montserrat u-small-text u-text u-text-variant u-text-2"> Somos una plataforma en línea dedicada a la venta de elementos y suministros relacionados con la agricultura, al mismo tiempo que ofrece oportunidades de empleo para personas que desean trabajar en áreas vinculadas a la agricultura sin necesidad de laborar en el campo. En esta página, los usuarios pueden encontrar una amplia gama de productos agrícolas, desde herramientas y maquinaria especializada hasta semillas y fertilizantes de alta calidad.</p>
        </div></footer>
      <section class="u-backlink u-clearfix u-grey-80">
    <script>

    


      // Retrieve post data from query parameters
      const queryParams = new URLSearchParams(window.location.search);
      const postID = queryParams.get("postID");

      if(sessionStorage.getItem("isLogged")=="true"){
        var authorInput = document.getElementById("author");
        var authorLabel = document.getElementById("author-label");

        // Eliminar el input
        authorInput.parentNode.removeChild(authorInput);

        // Eliminar la etiqueta (label)
        authorLabel.parentNode.removeChild(authorLabel);
      }
      //======================================fetch Get================================================
      const reviews = [];
      
      fetch(`http://localhost:8080/reviews/${postID}`)
          .then(response => {
            if (!response.ok) {
              throw new Error('La solicitud no fue exitosa');
            }
            // Parsear la respuesta a JSON
            return response.json();
          })
          .then(data => {
            // Trabajar con el objeto JSON recibido
            console.log('Objeto JSON recibido:', data);
            
            data.reviews.forEach(reviewData => {
              reviews.push({
                author: reviewData.user.name,
                content: reviewData.comment,
                rating: reviewData.rating
              })
            });
            document.getElementById("post-image").src = data.imageURL;
            document.getElementById("post-user").textContent = data.user.name;
            document.getElementById("post-title").textContent = data.product.name;
            document.getElementById("post-date").textContent = data.date;
            document.getElementById("post-content").textContent = data.description;
            populateReviews();
            //blogPosts = data;
          })
          .catch(error => {
            // Manejar errores de la solicitud
            console.error('Se produjo un error:', error);
          });                   
      class review{
        constructor(){

        }
      }


      // Function to populate reviews
      function populateReviews() {
          const reviewsList = document.getElementById("reviews-list");

          reviews.forEach((review) => {
              const li = document.createElement("li");
              li.innerHTML = `
                  <strong>${review.author}</strong><strong>'s Rating: </strong>${review.rating}/5<br> 
                  ${review.content}
              `;
              reviewsList.appendChild(li);
          });
      }

      // Call the function to populate reviews
      populateReviews();

      // Handle the "Organización o grupo" checkbox change event
      const groupCheckbox = document.getElementById("group");
      const groupFields = document.getElementById("group-fields");



      // Function to add a review, including the number of people involved (if applicable)
      const stars = document.getElementsByName('rate');
      let selectedValue = 0;

      stars.forEach((star) => {
          star.addEventListener('change', (event) => {
              selectedValue = event.target.value;
              console.log('Selected value:', selectedValue);
          });
      });
      function addReview() {

        let author = "";

        if(sessionStorage.getItem("isLogged")=="true"){
          author = sessionStorage.getItem("username");
        }else{
          author = document.getElementById("author").value;
        }
        const rating = selectedValue
        const content = document.getElementById("content").value;

        // Check if the input values are not empty
        if (author && content) {
          // Create a new review object
          const newReview = {
            author,
            date: new Date().toLocaleDateString(),
            content,
            rating,
          };
          
          // Add the new review to the reviews array
          reviews.push(newReview);

          //fetch del new review

          // Clear the form fields
          document.getElementById("review-form").reset();

          selectedValue=0

          // Hide the group fields
          document.getElementById("group-fields").style.display = "none";

          // Clear the reviews list before repopulating
          const reviewsList = document.getElementById("reviews-list");
          reviewsList.innerHTML = '';

          // Populate the reviews list with the updated data
          populateReviews();

          //======================================fetch Post================================================ 
          class User{
            constructor(type, name, id, userRating, allRatings, wallet, posts, email, password, commision){
              this.type = type;
              this.name = name;
              this.id = id;
              this.userRating = userRating;
              this.allRatings = allRatings;
              this.wallet = wallet;
              this.posts = posts;
              this.email = email;
              this.password = password;
              this.commision = commision;
            }
          }
          const fetchReview = {
            user: new User("singleUser", author, 0, 0, [], 0, [], "", "", 0.4),
            id: 0,
            rating: rating,
            allRatings: [],
            comment: content,
            likes: 0,
          };

          

          fetch(`http://localhost:8080/reviews/${postID}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(fetchReview),
          })
          .then(response => response.json())
          .then(createdReview => {
            // La respuesta 'createdReview' contendrá el objeto Review creado por el servidor
            console.log('Review creada:', createdReview);
            // Aquí puedes realizar cualquier operación con la review creada
          })
          .catch(error => {
            console.error('Error al crear la review:', error);
          });
          //======================================fetch================================================
        } else {
          alert("Please fill in all required review fields.");
        }
        
      }

// Function to handle "Comprar" button click

      //<!--!Fetchear usuario real, todos estos datos son para testear

        class Post{
          constructor(id, date, name, product, imageURL, reviews, price, user){
            this.id = id;
            this.date = date;
            this.name = name;
            this.product = product;
            this.imageURL = imageURL;
            this.reviews = reviews;
            this.price = price;
            this.user = user;
          }
          getReviews(){
            return this.reviews;
          }
          getPrice(){
            return this.price;
          }
        }


        class SingleUser{
        constructor(email, id, userRating, password){
          this.name = email.split('@')[0];
          this.id = id;
          this.userRating = userRating;
          this.wallet = 0;
          this.email = email;
          this.password = password;
        }
      }

      class unionUser{
        constructor(email, id, userRating, password, peopleInUnion){
          this.name = email.split('@')[0];
          this.id = id;
          this.userRating = userRating;
          this.wallet = 0;
          this.email = email;
          this.password = "";
          this.peopleInUnion = peopleInUnion;
		      this.commision = 0.07; //<!--!Esto en realidad se saca del post creo
        }
      }
        
      union = new unionUser("unionAgricola@gmail.com", 1234, 4, "union123",5);
      single = new SingleUser("single@gmail.com",4444,1,"single123");
      actualUser=union; //<!--!Aqui va el user real
      post = new Post(1, "fecha", "el peor serrucho", "cerrucho", "https://i.pinimg.com/1200x/8b/03/1c/8b031cd4c0f0dc70cd229d5dcb1a7497.jpg","revs1", 2122, single);


      if (actualUser instanceof SingleUser) {
        // If the user is not a unionUser, hide the Autor label and textbox
        document.getElementById("author-label").style.display = "none";
        document.getElementById("author").style.display = "none";
      }

document.getElementById("comprar-button").addEventListener("click", function() {
    // Retrieve post data from the placeholders
    const postTitle = document.getElementById("post-title").textContent;

    //<!--! Create a sale class item testing purposes
    class SaleRequest
    {
      constructor() 
      {
        this.quantity = document.getElementById("quantity").value;
        // this.buyer = actualUser;
      }
    }
    //<!--! la cantidad de sales que hayan en la db
    let saleReq = new SaleRequest ();

    // Log the sale item to the console (you can replace this with your desired logic)
    console.log("Sale item:");
    console.log(saleReq);
    
    fetch(`http://localhost:8080/salemade/${postID}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(saleReq),
            })
            .then(res=>res.json())
            .then(searchResults => {
                console.log('Sale stored',searchResults );
            })
            .catch((error) => {
                console.error('Error:', error);
            });
  });


  // Handle form submission
  document.getElementById("review-form").addEventListener("submit", function(event) {
    event.preventDefault();
    
    addReview();
  });

  const numberInput = document.getElementById("people-involved");
  
  numberInput.addEventListener("keydown", function(event) {
      if (event.key === "ArrowUp" || event.key === "ArrowDown") {
          // Allow arrow up and down keypresses
          return true;
      } else {
          // Prevent all other keyboard input
          event.preventDefault();
          return false;
      }
  });
    </script>
  </body>
</html>