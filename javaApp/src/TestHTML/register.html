<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Registration Page</title>
  <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
  <link rel='stylesheet' href='https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;display=swap'>
  <link rel="stylesheet" href="./register.css">
</head>
<body>
<a href="index.html" class="back-arrow">&#8592;</a>
<div class="screen-1">
    <svg class="logo" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="300" height="300" viewbox="0 0 640 480" xml:space="preserve">
        <g transform="matrix(3.31 0 0 3.31 320.4 240.4)">
        <circle style="stroke: rgb(0,0,0); stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(51,51,51); fill-rule: nonzero; opacity: 1;" cx="0" cy="0" r="40"></circle>
        </g>
        <g transform="matrix(0.98 0 0 0.98 268.7 213.7)">
        <circle style="stroke: rgb(0,0,0); stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(255,255,255); fill-rule: nonzero; opacity: 1;" cx="0" cy="0" r="40"></circle>
        </g>
        <g transform="matrix(1.01 0 0 1.01 362.9 210.9)">
        <circle style="stroke: rgb(0,0,0); stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(255,255,255); fill-rule: nonzero; opacity: 1;" cx="0" cy="0" r="40"></circle>
        </g>
        <g transform="matrix(0.92 0 0 0.92 318.5 286.5)">
        <circle style="stroke: rgb(0,0,0); stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(255,255,255); fill-rule: nonzero; opacity: 1;" cx="0" cy="0" r="40"></circle>
        </g>
        <g transform="matrix(0.16 -0.12 0.49 0.66 290.57 243.57)">
        <polygon style="stroke: rgb(0,0,0); stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(255,255,255); fill-rule: nonzero; opacity: 1;" points="-50,-50 -50,50 50,50 50,-50 "></polygon>
        </g>
        <g transform="matrix(0.16 0.1 -0.44 0.69 342.03 248.34)">
        <polygon style="stroke: rgb(0,0,0); stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(255,255,255); fill-rule: nonzero; opacity: 1;" vector-effect="non-scaling-stroke" points="-50,-50 -50,50 50,50 50,-50 "></polygon>
        </g>
      </svg>
      <!-- New organization checkbox -->
      <div class="organization">
        <input type="checkbox" id="organization" name="organization" value="
        organization">
        <label for="organization">Register an organization</label>
      </div>
      <div class="email">
        <label for="email">Email Address</label>
        <div class="sec-2">
          <ion-icon name="mail-outline"></ion-icon>
          <input type="email" name="email" id="emailInput" placeholder="Username@gmail.com"/>
        </div>
      </div>
      <div class="password">
        <label for="password">Password</label>
        <div class="sec-2">
          <ion-icon name="lock-closed-outline"></ion-icon>
          <input class="pas" type="password" name="password" id="passwordInput" placeholder="············"/>
          <ion-icon class="show-hide" name="eye-outline"onclick="togglePasswordVisibility('passwordInput')"></ion-icon>
        </div>
      </div>
      <!-- New registration fields -->
      <div class="confirm-password">
        <label for="confirm-password">Confirm Password</label>
        <div class="sec-2">
          <ion-icon name="lock-closed-outline"></ion-icon>
          <input class="pas" type="password" name="confirm-password" id="confirmPasswordInput" placeholder="············"/>
          <ion-icon class="show-hide" name="eye-outline"onclick="togglePasswordVisibility('confirmPasswordInput')"></ion-icon>
        </div>
      </div>
      <button class="login" onclick="submitForm()">Register</button>
      <div id="mensajeError"></div>
      <div class="footer"><span><a href="login.html">Login</a></span></div>
    </div>
  
    <script>
  function togglePasswordVisibility(inputId) {
    const passwordInput = document.getElementById(inputId);
    const eyeIcon = passwordInput.nextElementSibling;

    // Toggle the password input type between 'password' and 'text'
    if (passwordInput.type === 'password') {
      passwordInput.type = 'text';
      eyeIcon.name = 'eye-off-outline';
    } else {
      passwordInput.type = 'password';
      eyeIcon.name = 'eye-outline';
    }
  }

  function isValidEmail(email) {
    // Regular expression for basic email validation
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
  }

    function submitForm() {
    // Get input values
    var email = document.getElementById("emailInput").value;
    var password = document.getElementById("passwordInput").value;
    var confirmPassword = document.getElementById("confirmPasswordInput").value;
    var isOrganization = document.getElementById("organization").checked;

    const emailExists = isValidEmail(email);
    const passwordsMatch = password === confirmPassword;

    if (emailExists) {
      // Log values to the console
      console.log("Email:", email);
      console.log("Password:", password);
      console.log("Is Organization Account:", isOrganization);

      if (passwordsMatch) {
        console.log("Passwords match:", passwordsMatch);
        // Objeto de usuario para enviar en la solicitud POST
        
        let type = "singleUser";
        if (isOrganization) {
        type = "unionUser";
      } 
        
        const newUser = {
        type: "unionUser",
        name: "",
        id: 0,
        userRating: 0.0,
        allRatings: [],
        wallet: 0.0,
        posts: [],
        email: email,
        password: password,
        commision: 0.4
      };



        // Realizar la solicitud POST usando fetch
        fetch('/register', {
          method: 'POST', // Método de la solicitud
          headers: {
            'Content-Type': 'application/json', // Tipo de contenido que se está enviando (en este caso, JSON)
          },
          body: JSON.stringify(newUser), // Convertir el objeto a formato JSON para enviarlo
        })
        .then(response => {
          // Verificar si la solicitud fue exitosa (código de estado 200)
          if (!response.ok) {
            throw new Error('La solicitud no fue exitosa');
          }
          // Parsear la respuesta a JSON
          return response.json();
        })
        .then(data => {
          // Trabajar con la respuesta recibida
          console.log('Respuesta del servidor:', data);
          if (data != 0) {
            
            console.log('¡El usuario ha sido registrado!');
            console.log(type);
            //window.location.href = `Perfil.html?${data}`;
            // Guardar datos en sessionStorage
            console.log("s");
            sessionStorage.setItem('loggedID', data);
            sessionStorage.setItem('isLogged', true);
          } else {
            // Registro no exitoso
            const mensajeError = document.getElementById('mensajeError');
          if (mensajeError) {
            mensajeError.textContent = 'El correo ya ha sido registrado.';
          }
            console.log('El correo ya ha sido registrado previamente.');
          }
        })
        .catch(error => {
          // Manejar errores de la solicitud
          console.error('Se produjo un error:', error);
        });





      } else {
        console.log("Passwords do not match");
        // Display a message or take appropriate action to inform the user
        alert("Passwords do not match. Please check your input.");
      }
    } else {
      console.log("Email does not exist");
      // Display a message or take appropriate action to inform the user
      alert("Invalid email address. Please enter a valid email.");
    }
  }
    </script>
  </body>
  </html>
