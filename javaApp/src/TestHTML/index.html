<!DOCTYPE html>
<html style="font-size: 16px;" lang="en">
<head>
  <style>
    .u-blog-post {
      text-align: center;
      display: inline-block;
      border: 1px solid #ccc;
      border-radius: 10px;
      margin: 10px;
      padding: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .center-post {
      display: flex;
      justify-content: center;
    }

    .u-add-post-button{
      border: 0;
      background-color: #d9d9d9;
      padding-top: 8px;
      padding-bottom: 8px;
      cursor: pointer;
    }
  </style>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="utf-8">
  <meta name="keywords" content="AgroReviews">
  <meta name="description" content="">
  <title>Inicio</title>
  <link rel="stylesheet" href="nicepage.css" media="screen">
  <link rel="stylesheet" href="Inicio.css" media="screen">
  <script class="u-script" type="text/javascript" src="jquery.js" defer=""></script>
  <script class="u-script" type="text/javascript" src="nicepage.js" defer=""></script>
  <meta name="generator" content="Nicepage 5.20.7, nicepage.com">

  <link id="u-theme-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i|Open+Sans:300,300i,400,400i,500,500i,600,600i,700,700i,800,800i">
  <link id="u-page-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,500,500i,600,600i,700,700i,800,800i|Montserrat:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i">
  <meta name="theme-color" content="#478ac9">
  <meta property="og:title" content="Inicio">
  <meta property="og:type" content="website">
  <meta data-intl-tel-input-cdn-path="intlTelInput/">
</head>
<body data-home-page="index.html" data-home-page-title="Inicio" data-path-to-root="./" data-include-products="true" class="u-body u-xl-mode" data-lang="en">
  <input type="file" id="fileInput" style="display: none;" accept="image/*">
  <header class="u-clearfix u-grey-10 u-header u-sticky u-sticky-614f u-header" id="sec-e39e">
    <div class="u-clearfix u-sheet u-sheet-1">
      <h1 class="u-custom-font u-font-montserrat u-text u-text-1">AgroReviews</h1>
        <nav class="u-align-left u-font-size-14 u-menu u-menu-hamburger u-nav-spacing-25 u-offcanvas u-menu-1" data-responsive-from="XL">
          <div class="menu-collapse">
            <a class="u-button-style u-nav-link" href="#" style="padding: 4px 0px; font-size: calc(1em + 8px);">
              <svg class="u-svg-link" preserveAspectRatio="xMidYMin slice" viewBox="0 0 302 302"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#svg-7b92"></use></svg>
              <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="svg-7b92" x="0px" y="0px" viewBox="0 0 302 302" style="enable-background:new 0 0 302 302;" xml:space="preserve" class="u-svg-content"><g><rect y="36" width="302" height="30"></rect><rect y="236" width="302" height="30"></rect><rect y="136" width="302" height="30"></rect>
</g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g></svg>
            </a>
          </div>
          <div class="u-custom-menu u-nav-container-collapse">
            <div class="u-align-center u-border-2 u-border-grey-75 u-container-style u-custom-color-1 u-inner-container-layout u-sidenav">
              <div class="u-inner-container-layout u-sidenav-overflow">
                <div class="u-menu-close u-menu-close-1"></div>
                <ul class="u-align-left u-custom-font u-font-montserrat u-nav u-popupmenu-items u-unstyled u-nav-2"><li class="u-nav-item"><a class="u-button-style u-nav-link" href="index.html#sec-59ec">Inicio</a>
                </li><li></li> <button id="add-post-button" class="u-button u-button-primary u-button-1 u-add-post-button" type="submit" onclick="navigateToAddPost()">Sube un producto</button>
                  <li class="u-nav-item"><a class="u-button-style u-nav-link" href="#"onclick="navigateToPerfil()">Mi perfil</a>
                </li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="index.html#AboutUs">Acerca de nosotros</a>
                </li></ul>
              </div>
            </div>
            <div class="u-black u-menu-overlay u-opacity u-opacity-70"></div>
          </div>
        </nav>
        <form action="#" method="get" class="u-border-2 u-border-black u-expanded-width-xs u-radius-12 u-search u-search-left u-white u-search-1">
          <button class="u-search-button" type="submit">
            <span class="u-search-icon u-spacing-10">
              <svg class="u-svg-link" preserveAspectRatio="xMidYMin slice" viewBox="0 0 56.966 56.966"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#svg-a58f"></use></svg>
              <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="svg-a58f" x="0px" y="0px" viewBox="0 0 56.966 56.966" style="enable-background:new 0 0 56.966 56.966;" xml:space="preserve" class="u-svg-content"><path d="M55.146,51.887L41.588,37.786c3.486-4.144,5.396-9.358,5.396-14.786c0-12.682-10.318-23-23-23s-23,10.318-23,23  s10.318,23,23,23c4.761,0,9.298-1.436,13.177-4.162l13.661,14.208c0.571,0.593,1.339,0.92,2.162,0.92  c0.779,0,1.518-0.297,2.079-0.837C56.255,54.982,56.293,53.08,55.146,51.887z M23.984,6c9.374,0,17,7.626,17,17s-7.626,17-17,17  s-17-7.626-17-17S14.61,6,23.984,6z"></path></svg>
            </span>
          </button>
          <input class="u-custom-font u-font-montserrat u-search-input" type="search" name="search" value="" placeholder="Search">
        </form>
      </div>
    </header>
      <section class="u-clearfix" id="post-section">
        <div class="post-container center-post center" style="margin: 0 auto">
          <ul id="post-list" class="u-blog u-expanded-width u-blog-1">
            <!-- Posts will be added dynamically here -->
          </ul>
        </div>
      </section>




    <footer class="u-clearfix u-footer u-grey-80 u-footer" class="AboutUs"><div class="u-clearfix u-sheet u-sheet-1">
        <h4 class= "AboutUs"class="u-align-left u-custom-font u-font-montserrat u-text u-text-1">Acerca de nosotros</h4>
        <p class="u-align-left u-custom-font u-font-montserrat u-small-text u-text u-text-variant u-text-2"> Somos una plataforma en línea dedicada a la venta de elementos y suministros relacionados con la agricultura, al mismo tiempo que ofrece oportunidades de empleo para personas que desean trabajar en áreas vinculadas a la agricultura sin necesidad de laborar en el campo. En esta página, los usuarios pueden encontrar una amplia gama de productos agrícolas, desde herramientas y maquinaria especializada hasta semillas y fertilizantes de alta calidad.</p>
      </div></footer>
    <section class="u-backlink u-clearfix u-grey-80">
      <script>    
      let isLogged = sessionStorage.getItem('isLogged');
      console.log(isLogged);
      function navigateToPerfil() {
        isLogged = sessionStorage.getItem('isLogged');
        let profileID = sessionStorage.getItem('loggedID')
        let perfilURL;
        console.log(isLogged);
      if (isLogged === "true") {
        perfilURL = `Perfil.html?${profileID}`;
      } else {
        perfilURL = 'login.html';
      }
  
        // Navigate to the appropriate URL
        window.location.href = perfilURL;
      }
      function navigateToAddPost() {
        // Assuming you have a variable isLogged indicating the user's login status
        // Modify the destination URLs based on login status
        const addPostURL = isLogged ? 'addPost.html' : 'login.html';
        // Navigate to the appropriate URL
        window.location.href = addPostURL;
      }
        class BlogPost {
          
          // reemplazar constructor por este.
          constructor(rating, allRatings, id, date, description, price, product, imageURL, reviews, user) {
            this.rating = rating;
            this.allRatings = allRatings;
            this.id = id;
            this.date = date;
            this.description = description;
            this.price = price;
            this.product = product;
            this.imageURL = imageURL;
            this.reviews = reviews;
            this.user = user;
            
          }
          

          addReview(review) {
            this.reviews.push(review);
          }
      
          getAverageRating() {
            if (this.reviews.length === 0) {
              return 0;
            }
      
            const totalRating = this.reviews.reduce((sum, review) => sum + review.rating, 0);
            return totalRating / this.reviews.length;
          }
        }
      
        class Review {
          constructor(user, rating, comment) {
            this.user = user;
            this.rating = rating;
            this.comment = comment;
          }
        }

        class Product{
          constructor(name, price, type, condition){
            this.name = name;
            this.price = price;
            this.type = type;
            this.condition = condition;
          }
        }

        class User {
          constructor(type, name, id, userRating, wallet){
          this.type = type;
          this.name = name;
          this.id = id;
          this.userRating = userRating;
          this.wallet = 0;
          }
        }

      
        let blogPosts = [];

        //<!--!==================================================================================fetch
        // Realizar una solicitud GET usando fetch
        fetch('http://localhost:8080/posts')
          .then(response => {
            // Verificar si la solicitud fue exitosa (código de estado 200)
            if (!response.ok) {
              throw new Error('La solicitud no fue exitosa');
            }
            // Parsear la respuesta a JSON
            return response.json();
          })
          .then(data => {
            // Trabajar con el objeto JSON recibido
            data.forEach(postData => {
              let reviews = [];
              postData.reviews.forEach(reviewData => {
                const user = reviewData.user ? new User(reviewData.user.type, reviewData.user.name, reviewData.user.id, reviewData.user.userRating, reviewData.user.wallet) : null;
                const review = new Review(user, reviewData.rating, reviewData.comment);
                reviews.push(review);
              });

              const product = new Product(postData.product.name, postData.product.price, postData.product.type, postData.product.condition);

              const user = postData.user ? new User(postData.user.type, postData.user.name, postData.user.id, postData.user.userRating, postData.user.wallet) : null;

              const post = new BlogPost(postData.rating, postData.allRatings, postData.id, postData.date, postData.description, postData.price, product, postData.imageURL, reviews, user);
              blogPosts.push(post);
            });            
            console.log('Objeto JSON recibido:', data);
            displayPosts();
            //blogPosts = data;
          })
          .catch(error => {
            // Manejar errores de la solicitud
            console.error('Se produjo un error:', error);
          });

        //==================================================================================fetch

        // Modify the displayPosts function to clear the existing list and add all posts
        function displayPosts() {
          const postList = document.getElementById('post-list');
          // Clear the existing list
          postList.innerHTML = '';

          blogPosts.forEach((post) => {
            const listItem = document.createElement('li');
            listItem.classList.add('u-repeater-item'); // Add the repeater item class

            const postLink = document.createElement('a');
            postLink.href = `post.html?postID=${post.id}`;
            postLink.innerHTML = `
              <div class="u-blog-post u-container-style u-custom-color-1 u-radius-10 u-repeater-item u-shape-round">
                <div class="u-container-layout u-similar-container u-container-layout-1">
                  <a class="u-post-header-link" href="${post.product.name}.html">
                  </a>
                  <img alt="" class="custom-expanded u-blog-control u-image u-image-round u-radius-10 u-image-1" src="${post.imageURL}" width = 750>

                  <h4 class="u-blog-control u-text u-text-1">${post.product.name}</h4>
                  <div class="u-blog-control u-metadata u-metadata-1">
                    <span class="u-meta-author u-meta-icon">${post.date}</span>
                    <span class="u-meta-author u-meta-icon">${post.user.name}</span>
                    <span class="u-meta-author u-meta-icon">Comentarios: ${post.reviews.length}</span>
                    <span class="u-meta-tags u-meta-icon">Precio por unidad: ${post.price}</span>
                  </div>
                  <div class="style u-clearfix u-custom-html u-custom-html-1">
                    <meta charset="UTF-8">
                    <link rel="stylesheet" type="text/css" href="style.css">
                    <title></title>
                  </div>
                  <div class="u-image u-image-circle u-image-2" alt="" data-image-width="540" data-image-height="532"></div>
                </div>
              </div>
            `;

          listItem.appendChild(postLink);
          postList.appendChild(listItem);
          });
          }
        // Add an event listener to execute the function once the page is loaded
        window.addEventListener('load', displayPosts);

    </script>
  </body>
</html>